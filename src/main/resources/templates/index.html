<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homepage</title>
<link rel="stylesheet" th:href="@{/css/homepage.css}">
</head>
<body>
	<div class="container">
		<header>
			<div class="header-left">
				<h2>Current Week Deployment Schedule</h2>
				<div class="calendar-container">
					<div class="calendar">
						<div class="calendar-header">
							<button class="calendar-nav">◀</button>
							<h3 id="calendar-month-year">November 2024</h3>
							<button class="calendar-nav">▶</button>
						</div>
						<div class="calendar-days">
							<div class="calendar-day">Sun</div>
							<div class="calendar-day">Mon</div>
							<div class="calendar-day">Tue</div>
							<div class="calendar-day">Wed</div>
							<div class="calendar-day">Thu</div>
							<div class="calendar-day">Fri</div>
							<div class="calendar-day">Sat</div>
							<!-- Days will be generated dynamically here by JavaScript -->
						</div>
					</div>
				</div>
			</div>

			<div class="sccontainer">
				<div class="search-container">
					<label for="search-input" class="search-label">Search by
						TFS #:</label> <input type="text" id="searchInput"
						placeholder="Enter TFS number" class="search-input">
					<button id="searchButton" class="search-button">Search</button>
				</div>

				<!-- Results Section -->
				<div class="results-section">
					<table id="resultsTable" class="result-table"
						style="display: none;">
						<thead>
							<tr>
								<th>TFS Number</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody id="resultsBody"></tbody>
					</table>
					<p id="message" class="message"></p>
				</div>
			</div>


			<div class="header-right">
				<h1>
					Hello, <span id="user-name">Raja Murugan</span>
				</h1>
			</div>
		</header>



		<div class="story-sections">
			<div class="story-box">
				<h3>RG Stories</h3>
				<ul>
					<li><a href="/openRGStory?storyNumber=123456">123456</a></li>
					<li><a href="/openRGStory?storyNumber=345676">345676</a></li>
					<li><a href="page3.html">546732</a></li>
					<li><a href="page4.html">354335</a></li>
					<li><a href="page5.html">657532</a></li>
					<li><a href="page6.html">465763</a></li>
					<li><a href="page7.html">643634</a></li>
				</ul>
			</div>
			<div class="story-box">
				<h3>ENR Stories</h3>
				<ul>
					<li><a href="page1.html">123456</a></li>
					<li><a href="page2.html">345676</a></li>
					<li><a href="page3.html">546732</a></li>
					<li><a href="page4.html">354335</a></li>
					<li><a href="page5.html">657532</a></li>
					<li><a href="page6.html">465763</a></li>
					<li><a href="page7.html">643634</a></li>
				</ul>
			</div>
			<div class="story-box">
				<h3>BF Stories</h3>
				<ul>
					<li><a href="page1.html">123456</a></li>
					<li><a href="page2.html">345676</a></li>
					<li><a href="page3.html">546732</a></li>
					<li><a href="page4.html">354335</a></li>
					<li><a href="page5.html">657532</a></li>
					<li><a href="page6.html">465763</a></li>
					<li><a href="page7.html">643634</a></li>
				</ul>
			</div>
		</div>

		<div class="tools-section">
			<h3>Stand-alone tools</h3>
			<div class="tools">
				<button>Peer Review</button>
				<button>DB to DB</button>
				<button>Pre-Impact</button>
				<button>Analyst Checklist</button>
				<button>Standard Queries</button>
				<button>PDD</button>
				<button>[Place Holder]</button>
			</div>
		</div>
	</div>
	<script src="script.js"></script>

	<script>
	document.addEventListener("DOMContentLoaded", function () {
	    renderCalendar(new Date());
	});

	function renderCalendar(currentDate) {
	    const calendarContainer = document.querySelector(".calendar");
	    const daysContainer = document.createElement("div");
	    daysContainer.classList.add("calendar-days");
	    calendarContainer.innerHTML = ""; // Clear previous content

	    // Header with navigation and current month/year
	    const header = document.createElement("div");
	    header.classList.add("calendar-header");

	    const prevButton = document.createElement("button");
	    prevButton.classList.add("calendar-nav");
	    prevButton.textContent = "<";
	    prevButton.onclick = () => renderCalendar(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1));

	    const nextButton = document.createElement("button");
	    nextButton.classList.add("calendar-nav");
	    nextButton.textContent = ">";
	    nextButton.onclick = () => renderCalendar(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1));

	    const monthYear = document.createElement("h3");
	    monthYear.textContent = currentDate.toLocaleDateString("en-US", { month: "long", year: "numeric" });

	    header.appendChild(prevButton);
	    header.appendChild(monthYear);
	    header.appendChild(nextButton);
	    calendarContainer.appendChild(header);

	    // Days of the week
	    const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
	    daysOfWeek.forEach(day => {
	        const dayElement = document.createElement("div");
	        dayElement.classList.add("calendar-day");
	        dayElement.textContent = day;
	        dayElement.style.fontWeight = "bold";
	        daysContainer.appendChild(dayElement);
	    });

	    // Dates
	    const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
	    const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
	    const startDay = firstDay.getDay();

	    // Get the start of the current week
	    const today = new Date();
	    const currentWeekStart = new Date(today.setDate(today.getDate() - today.getDay())); // Sunday of current week
	    const currentWeekEnd = new Date(currentWeekStart);
	    currentWeekEnd.setDate(currentWeekStart.getDate() + 6); // Saturday of current week

	    // Add empty placeholders for days before the first of the month
	    for (let i = 0; i < startDay; i++) {
	        const placeholder = document.createElement("div");
	        placeholder.classList.add("calendar-day");
	        daysContainer.appendChild(placeholder);
	    }

	    // Add day numbers
	    for (let i = 1; i <= lastDay.getDate(); i++) {
	        const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);
	        const dayElement = document.createElement("div");
	        dayElement.classList.add("calendar-day");
	        dayElement.textContent = i;

	        // Highlight Monday, Wednesday, and Thursday if within the current week
	        if (date >= currentWeekStart && date <= currentWeekEnd && [1, 3, 4].includes(date.getDay())) {
	            dayElement.classList.add("highlight");
	        }

	        // Highlight today's date
	        if (i === new Date().getDate() && currentDate.getMonth() === new Date().getMonth() && currentDate.getFullYear() === new Date().getFullYear()) {
	            dayElement.classList.add("today");
	        }
	        
	        daysContainer.appendChild(dayElement);
	    }

	    calendarContainer.appendChild(daysContainer);
	}
    </script>

	<script>
        document.addEventListener("DOMContentLoaded", function () {
            const searchButton = document.getElementById("searchButton");
            const searchInput = document.getElementById("searchInput");
            const resultsTable = document.getElementById("resultsTable");
            const resultsBody = document.getElementById("resultsBody");
            const message = document.getElementById("message");

            // Event Listener for Search Button
            searchButton.addEventListener("click", function () {
                const folderName = searchInput.value.trim();
                if (!folderName) {
                    message.textContent = "Please enter a TFS # to begin search.";
                    resultsTable.style.display = "none";
                    return;
                }

                // Clear previous results
                message.textContent = "";
                resultsBody.innerHTML = "";

                // Send Request to Backend
                fetch(`/checkFolder?folderName=${folderName}`)
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error("Folder check failed.");
                        }
                        return response.json();
                    })
                    .then((data) => {
                        if (data.exists) {
                            // Folder exists
                            resultsTable.style.display = "table";
                            const row = document.createElement("tr");

                            const tfsCell = document.createElement("td");
                            tfsCell.textContent = folderName;
                            row.appendChild(tfsCell);

                            const actionCell = document.createElement("td");
                            actionCell.innerHTML = "<button class='add-button' disabled>Exists</button>";
                            row.appendChild(actionCell);

                            resultsBody.appendChild(row);
                        } else {
                            // Folder does not exist
                            resultsTable.style.display = "table";
                            const row = document.createElement("tr");

                            const tfsCell = document.createElement("td");
                            tfsCell.textContent = folderName;
                            row.appendChild(tfsCell);

                            const actionCell = document.createElement("td");
                            const addButton = document.createElement("button");
                            addButton.className = "add-button";
                            addButton.textContent = "Add";
                            addButton.addEventListener("click", function () {
                                // Add folder logic
                                fetch(`/createFolder?folderName=${folderName}`, { method: "POST" })
                                    .then((createResponse) => {
                                        if (!createResponse.ok) {
                                            throw new Error("Folder creation failed.");
                                        }
                                        return createResponse.text();
                                    })
                                    .then(() => {
                                        alert("Folder created successfully!");
                                        addButton.disabled = true;
                                        addButton.textContent = "Added";
                                    })
                                    .catch((error) => {
                                        console.error(error);
                                        alert("Failed to create folder.");
                                    });
                            });
                            actionCell.appendChild(addButton);
                            row.appendChild(actionCell);

                            resultsBody.appendChild(row);
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                        message.textContent = "Error occurred while searching.";
                        resultsTable.style.display = "none";
                    });
            });
        });
    </script>

</body>
</html>
